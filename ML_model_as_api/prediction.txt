import serial
import requests
import json

# Define the serial port
serial_port = 'COM4'  # Adjust this to match your Arduino's serial port
baud_rate = 115200

# Define the URL of your FastAPI endpoint
url = 'http://127.0.0.1:8000/parkinson_prediction'  # Adjust this to match your endpoint

# Open serial connection
ser = serial.Serial(serial_port, baud_rate)

try:
    while True:
        # Read line from serial
        line = ser.readline().decode('latin-1').strip()

        # Split the line into key-value pairs
        items = line.split(",")
        data_dict = {}
        for item in items:
            pair = item.split(":")
            if len(pair) == 2:
                key, value = pair
                data_dict[key.strip()] = value.strip()
        
        # Send data to FastAPI endpoint
        response = requests.post(url, json=data_dict)
        
        # Print the prediction result
        print("Prediction:", response.text)
        
except KeyboardInterrupt:
    print("Stopping...")
    ser.close()
